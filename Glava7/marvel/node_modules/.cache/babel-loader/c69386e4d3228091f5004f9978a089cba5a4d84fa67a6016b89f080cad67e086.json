{"ast":null,"code":"import _toConsumableArray from\"C:/OSPanel/domains/Project1-master/Glava7/marvel/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _classCallCheck from\"C:/OSPanel/domains/Project1-master/Glava7/marvel/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"C:/OSPanel/domains/Project1-master/Glava7/marvel/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"C:/OSPanel/domains/Project1-master/Glava7/marvel/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"C:/OSPanel/domains/Project1-master/Glava7/marvel/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{Component}from'react';import Spinner from'../spinner/Spinner';import ErrorMessage from'../errorMessage/ErrorMessage';import MarvelService from'../../services/MarvelService';import'./charList.scss';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CharList=/*#__PURE__*/function(_Component){_inherits(CharList,_Component);var _super=_createSuper(CharList);function CharList(){var _this;_classCallCheck(this,CharList);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={charList:[],loading:true,error:false,newItemLoading:false,offset:210,charEnded:false};_this.marvelService=new MarvelService();_this.onRequest=function(offset){_this.onCharListLoading();_this.marvelService.getAllCharacters(offset).then(_this.onCharListLoaded).catch(_this.onError);};_this.onCharListLoading=function(){_this.setState({newItemLoading:true});};_this.onCharListLoaded=function(newCharList){var ended=false;if(newCharList.length<9){ended=true;}_this.setState(function(_ref){var offset=_ref.offset,charList=_ref.charList;return{charList:[].concat(_toConsumableArray(charList),_toConsumableArray(newCharList)),loading:false,newItemLoading:false,offset:offset+9,charEnded:ended};});};_this.onError=function(){_this.setState({error:true,loading:false});};_this.itemRefs=[];_this.setRef=function(ref){_this.itemRefs.push(ref);};_this.focusOnItem=function(id){_this.itemRefs.forEach(function(item){return item.classList.remove('char__item_selected');});_this.itemRefs[id].classList.add('char__item_selected');_this.itemRefs[id].focus();};return _this;}_createClass(CharList,[{key:\"componentDidMount\",value:function componentDidMount(){this.onRequest();}},{key:\"renderItems\",value:// Этот метод создан для оптимизации, \n// чтобы не помещать такую конструкцию в метод render\nfunction renderItems(arr){var _this2=this;var items=arr.map(function(item,i){var imgStyle={'objectFit':'cover'};if(item.thumbnail==='http://i.annihil.us/u/prod/marvel/i/mg/b/40/image_not_available.jpg'){imgStyle={'objectFit':'unset'};}return/*#__PURE__*/_jsxs(\"li\",{className:\"char__item\",tabIndex:0,ref:_this2.setRef,onClick:function onClick(){_this2.props.onCharSelected(item.id);_this2.focusOnItem(i);},onKeyPress:function onKeyPress(e){if(e.key===' '||e.key===\"Enter\"){_this2.props.onCharSelected(item.id);_this2.focusOnItem(i);}},children:[/*#__PURE__*/_jsx(\"img\",{src:item.thumbnail,alt:item.name,style:imgStyle}),/*#__PURE__*/_jsx(\"div\",{className:\"char__name\",children:item.name})]},item.id);});// А эта конструкция вынесена для центровки спиннера/ошибки\nreturn/*#__PURE__*/_jsx(\"ul\",{className:\"char__grid\",children:items});}},{key:\"render\",value:function render(){var _this3=this;var _this$state=this.state,charList=_this$state.charList,loading=_this$state.loading,error=_this$state.error,offset=_this$state.offset,newItemLoading=_this$state.newItemLoading,charEnded=_this$state.charEnded;var items=this.renderItems(charList);var errorMessage=error?/*#__PURE__*/_jsx(ErrorMessage,{}):null;var spinner=loading?/*#__PURE__*/_jsx(Spinner,{}):null;var content=!(loading||error)?items:null;return/*#__PURE__*/_jsxs(\"div\",{className:\"char__list\",children:[errorMessage,spinner,content,/*#__PURE__*/_jsx(\"button\",{className:\"button button__main button__long\",disabled:newItemLoading,style:{'display':charEnded?'none':'block'},onClick:function onClick(){return _this3.onRequest(offset);},children:/*#__PURE__*/_jsx(\"div\",{className:\"inner\",children:\"load more\"})})]});}}]);return CharList;}(Component);export default CharList;","map":{"version":3,"names":["Component","Spinner","ErrorMessage","MarvelService","jsx","_jsx","jsxs","_jsxs","CharList","_Component","_inherits","_super","_createSuper","_this","_classCallCheck","_len","arguments","length","args","Array","_key","call","apply","concat","state","charList","loading","error","newItemLoading","offset","charEnded","marvelService","onRequest","onCharListLoading","getAllCharacters","then","onCharListLoaded","catch","onError","setState","newCharList","ended","_ref","_toConsumableArray","itemRefs","setRef","ref","push","focusOnItem","id","forEach","item","classList","remove","add","focus","_createClass","key","value","componentDidMount","renderItems","arr","_this2","items","map","i","imgStyle","thumbnail","className","tabIndex","onClick","props","onCharSelected","onKeyPress","e","children","src","alt","name","style","render","_this3","_this$state","errorMessage","spinner","content","disabled"],"sources":["C:/OSPanel/domains/Project1-master/Glava7/marvel/src/components/charList/CharList.js"],"sourcesContent":["import {Component} from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport Spinner from '../spinner/Spinner';\r\nimport ErrorMessage from '../errorMessage/ErrorMessage';\r\nimport MarvelService from '../../services/MarvelService';\r\nimport './charList.scss';\r\n\r\nclass CharList extends Component {\r\n\r\n    state = {\r\n        charList: [],\r\n        loading: true,\r\n        error: false,\r\n        newItemLoading: false,\r\n        offset: 210,\r\n        charEnded: false\r\n    }\r\n    \r\n    marvelService = new MarvelService();\r\n\r\n    componentDidMount() {\r\n        this.onRequest();\r\n    }\r\n\r\n    onRequest = (offset) => {\r\n        this.onCharListLoading();\r\n        this.marvelService.getAllCharacters(offset)\r\n            .then(this.onCharListLoaded)\r\n            .catch(this.onError)\r\n    }\r\n\r\n    onCharListLoading = () => {\r\n        this.setState({\r\n            newItemLoading: true\r\n        })\r\n    }\r\n\r\n    onCharListLoaded = (newCharList) => {\r\n        let ended = false;\r\n        if (newCharList.length < 9) {\r\n            ended = true;\r\n        }\r\n\r\n        this.setState(({offset, charList}) => ({\r\n            charList: [...charList, ...newCharList],\r\n            loading: false,\r\n            newItemLoading: false,\r\n            offset: offset + 9,\r\n            charEnded: ended\r\n        }))\r\n    }\r\n\r\n    onError = () => {\r\n        this.setState({\r\n            error: true,\r\n            loading: false\r\n        })\r\n    }\r\n\r\n    itemRefs = [];\r\n\r\n    setRef = (ref) => {\r\n        this.itemRefs.push(ref);\r\n    }\r\n\r\n    focusOnItem = (id) => {\r\n        this.itemRefs.forEach(item => item.classList.remove('char__item_selected'));\r\n        this.itemRefs[id].classList.add('char__item_selected');\r\n        this.itemRefs[id].focus();\r\n    }\r\n\r\n    // Этот метод создан для оптимизации, \r\n    // чтобы не помещать такую конструкцию в метод render\r\n    renderItems(arr) {\r\n        const items =  arr.map((item, i) => {\r\n            let imgStyle = {'objectFit' : 'cover'};\r\n            if (item.thumbnail === 'http://i.annihil.us/u/prod/marvel/i/mg/b/40/image_not_available.jpg') {\r\n                imgStyle = {'objectFit' : 'unset'};\r\n            }\r\n            \r\n            return (\r\n                <li \r\n                    className=\"char__item\"\r\n                    tabIndex={0}\r\n                    ref={this.setRef}\r\n                    key={item.id}\r\n                    onClick={() => {\r\n                        this.props.onCharSelected(item.id);\r\n                        this.focusOnItem(i);\r\n                }}\r\n                onKeyPress={(e) => {\r\n                    if (e.key === ' ' || e.key === \"Enter\") {\r\n                        this.props.onCharSelected(item.id);\r\n                        this.focusOnItem(i);\r\n                    }\r\n                }}>\r\n                        <img src={item.thumbnail} alt={item.name} style={imgStyle}/>\r\n                        <div className=\"char__name\">{item.name}</div>\r\n                </li>\r\n            )\r\n        });\r\n        // А эта конструкция вынесена для центровки спиннера/ошибки\r\n        return (\r\n            <ul className=\"char__grid\">\r\n                {items}\r\n            </ul>\r\n        )\r\n    }\r\n\r\n    render() {\r\n\r\n        const {charList, loading, error, offset, newItemLoading, charEnded} = this.state;\r\n        \r\n        const items = this.renderItems(charList);\r\n\r\n        const errorMessage = error ? <ErrorMessage/> : null;\r\n        const spinner = loading ? <Spinner/> : null;\r\n        const content = !(loading || error) ? items : null;\r\n\r\n        return (\r\n            <div className=\"char__list\">\r\n                {errorMessage}\r\n                {spinner}\r\n                {content}\r\n                <button \r\n                    className=\"button button__main button__long\"\r\n                    disabled={newItemLoading}\r\n                    style={{'display': charEnded ? 'none' : 'block'}}\r\n                    onClick={() => this.onRequest(offset)}>\r\n                    <div className=\"inner\">load more</div>\r\n                </button>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n    CharList.propTypes = {\r\n        onCharSelected: PropTypes.func.isRequired\r\n    }\r\n\r\nexport default CharList;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}